import mysql.connector
from dotenv import load_dotenv
import os

load_dotenv()  # Load environment variables from .env file

# Connect to MySQL (ensure MySQL server is running)
db_connection = mysql.connector.connect(
    host=os.getenv('DB_HOST'),          # MySQL server address
    user=os.getenv('DB_USER'),      # Your MySQL username
    password=os.getenv('DB_PASSWORD')   # Your MySQL password
)

# Create a cursor object
cursor = db_connection.cursor()

# Create a new database (if it doesn't exist)
cursor.execute("CREATE DATABASE IF NOT EXISTS vulnerability_assessment")

# Use the new database
cursor.execute("USE vulnerability_assessment")

# Create the vulnerabilities table
cursor.execute('''
CREATE TABLE IF NOT EXISTS vulnerabilities (
    id INT AUTO_INCREMENT PRIMARY KEY,
    url VARCHAR(255) NOT NULL,
    vulnerability_type VARCHAR(255) NOT NULL,
    severity VARCHAR(50) NOT NULL,
    date_detected DATETIME NOT NULL,
    remediation_status VARCHAR(50) DEFAULT 'Not Remediated'
)
''')

# Commit changes and close the connection
db_connection.commit()
cursor.close()
db_connection.close()
